{% extends "page.html" %}

{% load gravatar i18n %}

{% block title %}- {% trans "Profile" %}{% endblock %}

{% block styles %}
  {{ block.super }}
  <style>
    body {
      background: {{ site_globals.background_color|default:'#efefef' }};
    }

    .profile-header .profile-name {
      color: {{ site_globals.primary_text_color|default:'#ffffff' }};
    }
  </style>
{% endblock %}

{% block primary_content %}
  {% block profile_header %}
    <div class="profile-header" style="background-color: {{ site_globals.secondary_color|default:'#1b95dc' }};">
      <div class="row">
        <div class="col-md-3 col-md-offset-2">
          <div class="profile-image-wrapper">
            {% gravatar context_user.email 250 %}
          </div>
        </div>
        <div class="col-md-7">
          <span class="profile-name">{% if context_user.first_name %}{{ context_user.first_name }} {{ context_user.last_name }}{% else %}{{ context_user.username }}{% endif %}</span>
        </div>
      </div>
    </div>
  {% endblock %}

  {% block edit_button %}
    {% if context_user.username == user.username %}
      <div class="row">
        <div class="col-md-12">
          <div class="profile-edit-button">
            <a href="{% url 'user:settings' username=context_user.username %}" class="btn btn-default btn-lg">{% trans "Edit" %}</a>
          </div>
        </div>
      </div>
    {% endif %}
  {% endblock %}

  {% block profile_sections %}
    {% trans "Not Given" as not_given_tr %}
    <div class="profile-section first">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>{% trans "Name" %}</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          {% block name_parameters %}
          <ul>
            <li><span class="parameter">{% trans "First Name" %}:</span><span class="value">{{ context_user.first_name|default:not_given_tr }}</span></li>
            <li><span class="parameter">{% trans "Last Name" %}:</span><span class="value">{{ context_user.last_name|default:not_given_tr }}</span></li>
          </ul>
          {% endblock %}
        </div>
      </div>
    </div>

    <div class="profile-section">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>{% trans "Credentials" %}</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          {% block credential_parameters %}
          <ul>
            <li><span class="parameter">{% trans "Username" %}:</span><span class="value">{{ context_user.username }}</span></li>
            {% if context_user.has_usable_password and user.username == context_user.username %}
              <li><span class="parameter">{% trans "Password" %}:</span><span class="value">********</span></li>
            {% endif %}
            {% if user.username == context_user.username %}
              <li><span class="parameter">{% trans "2-Step Verification" %}: </span><span class="value">{% if has_mfa %}Enabled{% else %}{% trans "Not Enabled" %}{% endif %}</span></li>
            {% endif %}
          </ul>
          {% endblock %}
        </div>
      </div>
    </div>

    <div class="profile-section">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>{% trans "API Key" %}</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          <ul>
            <li>
              <span class="parameter">{% trans "Token" %}:</span>
              {% if user.username == context_user.username %}
                {% if show_user_token_mfa %}
                <span class="value">{{ user_token }}</span>
                {% else %}
                <span class="value">{% trans "Enable 2-Step verification to view token" %}</span>
                {% endif %}
              {% else %}
                <span class="label label-info">{% trans "Private" %}</span>
              {% endif %}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <h5> </h5>
    <div class="profile-section">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>{% trans "Email" %}</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          {% block gravatar_parameters %}
          <ul>
            <li><span class="parameter">{% trans "Email" %}:</span><span class="value">{% if user.username == context_user.username %}{{ user.email|default:not_given_tr }}{% else %}<span class="label label-info">{% trans "Private" %}</span>{% endif %}</span></li>
          </ul>
          {% endblock %}
        </div>
      </div>
    </div>

    {% if backends.backends %}
    <div class="profile-section social">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>{% trans "Social" %}</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          {% block social_parameters %}
          <ul>
            <li><span class="parameter">Connected:</span>
              {% if user.username == context_user.username %}
                {% if backends.associated %}
                  {% include 'tethys_portal/user/social_labels.html' with backends=backends.associated %}
                {% else %}
                  <span>{% trans "None" %}</span>
                {% endif %}
              {% else %}
                <span class="label label-info">{% trans "Private" %}</span>
              {% endif %}
            </span></li>
            <li><span class="parameter">{% trans "Not Connected" %}:</span>
              {% if user.username == context_user.username %}
                {% if backends.not_associated %}
                  {% include 'tethys_portal/user/social_labels.html' with backends=backends.not_associated %}
                {% else %}
                  <span>{% trans "None" %}</span>
                {% endif %}
              {% else %}
                <span class="label label-info">{% trans "Private" %}</span>
              {% endif %}
            </span></li>
          </ul>
          {% endblock %}
        </div>
      </div>
    </div>
    {% endif %}

    {% block account_parameters %}
      {% if user.username == context_user.username %}
        <div class="profile-section">
      {% else %}
        <div class="profile-section last">
      {% endif %}
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>{% trans "Account" %}</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          <ul>
            <li><span class="parameter">{% trans "Member Since" %}:</span><span class="value">{{ context_user.date_joined|date:"F j, Y" }}</span></li>
            <li><span class="parameter">{% trans "Status" %}:</span><span class="value">{% if context_user.is_active %}{% trans "Active" %}{% else %}{% trans "Inactive" %}{% endif %}</span></li>
          </ul>
        </div>
      </div>
    </div>
    {% endblock %}
    {% block workspace_management %}
      {% if user.username == context_user.username %}
        <div class="profile-section last">
          <div class="row">
            <div class="col-md-2 col-md-offset-2 profile-section-header">
              <h3>{% trans "Workspace" %}</h3>
            </div>
            <div class="col-md-8 profile-parameters">
              <ul>
                <li><span class="parameter">{% trans "Storage Summary" %}:</span><span class="value">{{ current_use }} {% trans "of" %} {{ quota|default:"&#8734;" }}</span></li>
              </ul>
            </div>
          </div>
        </div>
      {% endif%}
    {% endblock %}
  {% endblock %}

{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script>

    function resize_profile_name() {
      var profile_name_element, name_height, header_height;



      profile_name_element = $('.profile-header .profile-name');
      name_height = parseInt(profile_name_element.css('height'));
      header_height = parseInt($('.profile-header').css('height'));

      if (name_height > 215 && header_height === 250) {
        profile_name_element.css('padding-top', '46px');

      } else if (name_height <= 215 && header_height === 250) {
        profile_name_element.css('padding-top', '130px');

      } else if (name_height > 88 && header_height === 125) {
        profile_name_element.css('padding-top', '12px');

      } else if (name_height <= 88 && header_height === 125) {
        profile_name_element.css('padding-top', '38px');
      }
    }

    // Check when page loads
    window.onload = function(event){
      resize_profile_name();
    }

    // Also check on page resize event
    window.onresize = function(event) {
      resize_profile_name();
    }
  </script>
{% endblock %}
