{% extends "page.html" %}

{% load gravatar %}

{% block title %}- Profile{% endblock %}

{% block styles %}
  {{ block.super }}
  <style>
    body {
      background: {{ site_globals.background_color|default:'#efefef' }};
    }

    .profile-header .profile-name {
      color: {{ site_globals.primary_text_color|default:'#ffffff' }};
    }
  </style>
{% endblock %}

{% block primary_content %}
  {% block profile_header %}
    <div class="profile-header" style="background-color: {{ site_globals.secondary_color|default:'#1b95dc' }};">
      <div class="row">
        <div class="col-md-3 col-md-offset-2">
          <div class="profile-image-wrapper">
            {% if user.email %}{% gravatar user.email 250 %}{% else %}{% gravatar "tethys@example.com" 250 %}{% endif %}
          </div>
        </div>
        <div class="col-md-7">
          <span class="profile-name">{% if user.first_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %}</span>
        </div>
      </div>
    </div>
  {% endblock %}

  {% block edit_button %}
    <div class="row">
      <div class="col-md-12">
        <div class="profile-edit-button">
          <a href="{% url 'user:settings' %}" class="btn btn-default btn-lg">Edit</a>
        </div>
      </div>
    </div>
  {% endblock %}

  {% block profile_sections %}
    <div class="profile-section first">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>Name</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          {% block name_parameters %}
          <ul>
            <li><span class="parameter">First Name:</span><span class="value">{{ user.first_name|default:"Not Given" }}</span></li>
            <li><span class="parameter">Last Name:</span><span class="value">{{ user.last_name|default:"Not Given" }}</span></li>
          </ul>
          {% endblock %}
        </div>
      </div>
    </div>

    <div class="profile-section">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>Credentials</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          {% block credential_parameters %}
          <ul>
            <li><span class="parameter">Username:</span><span class="value">{{ user.username }}</span></li>
            {% if user.has_usable_password %}
              <li><span class="parameter">Password:</span><span class="value">********</span></li>
            {% endif %}
              <li><span class="parameter">2-Step Verification: </span><span class="value">{% if has_mfa %}Enabled{% else %}Not Enabled{% endif %}</span></li>
          </ul>
          {% endblock %}
        </div>
      </div>
    </div>

    <div class="profile-section">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>API Key</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          <ul>
            <li>
              <span class="parameter">Token:</span>
              {% if show_user_token_mfa %}
              <span class="value">{{ user_token }}</span>
              {% else %}
              <span class="value">Enable 2-Step verification to view token</span>
              {% endif %}
            </li>
          </ul>
        </div>
      </div>
    </div>

    <h5> </h5>
    <div class="profile-section">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>Email</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          {% block gravatar_parameters %}
          <ul>
            <li><span class="parameter">Email:</span><span class="value">{{ user.email|default:"Not Given" }}</span></li>
          </ul>
          {% endblock %}
        </div>
      </div>
    </div>

    {% if backends.backends %}
    <div class="profile-section social">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>Social</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          {% block social_parameters %}
          <ul>
            <li><span class="parameter">Connected:</span>
              {% if backends.associated %}
                {% include 'tethys_portal/user/social_labels.html' with backends=backends.associated %}
              {% else %}
                <span>None</span>
              {% endif %}
            </span></li>
            <li><span class="parameter">Not Connected:</span>
              {% if backends.not_associated %}
                {% include 'tethys_portal/user/social_labels.html' with backends=backends.not_associated %}
              {% else %}
                <span>None</span>
              {% endif %}
            </span></li>
          </ul>
          {% endblock %}
        </div>
      </div>
    </div>
    {% endif %}

    {% block account_parameters %}
      <div class="profile-section">
      <div class="row">
        <div class="col-md-2 col-md-offset-2 profile-section-header">
          <h3>Account</h3>
        </div>
        <div class="col-md-8 profile-parameters">
          <ul>
            <li><span class="parameter">Member Since:</span><span class="value">{{ user.date_joined|date:"F j, Y" }}</span></li>
            <li><span class="parameter">Status:</span><span class="value">{% if user.is_active %}Active{% else %}Inactive{% endif %}</span></li>
          </ul>
        </div>
      </div>
    </div>
    {% endblock %}
    {% block workspace_management %}
      <div class="profile-section last">
        <div class="row">
          <div class="col-md-2 col-md-offset-2 profile-section-header">
            <h3>Workspace</h3>
          </div>
          <div class="col-md-8 profile-parameters">
            <ul>
              <li><span class="parameter">Storage Summary:</span><span class="value">{{ current_use }} of {{ quota|default:"&#8734;" }}</span></li>
            </ul>
          </div>
        </div>
      </div>
    {% endblock %}
  {% endblock %}

{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script>

    function resize_profile_name() {
      var profile_name_element, name_height, header_height;



      profile_name_element = $('.profile-header .profile-name');
      name_height = parseInt(profile_name_element.css('height'));
      header_height = parseInt($('.profile-header').css('height'));

      if (name_height > 215 && header_height === 250) {
        profile_name_element.css('padding-top', '46px');

      } else if (name_height <= 215 && header_height === 250) {
        profile_name_element.css('padding-top', '130px');

      } else if (name_height > 88 && header_height === 125) {
        profile_name_element.css('padding-top', '12px');

      } else if (name_height <= 88 && header_height === 125) {
        profile_name_element.css('padding-top', '38px');
      }
    }

    // Check when page loads
    window.onload = function(event){
      resize_profile_name();
    }

    // Also check on page resize event
    window.onresize = function(event) {
      resize_profile_name();
    }
  </script>
{% endblock %}
