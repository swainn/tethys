<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Docker Development Environment &mdash; Tethys Platform 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Tethys Platform 0.1.0 documentation" href="../index.html" />
    <link rel="up" title="Setup Development Environment" href="../dev_environment.html" />
    <link rel="next" title="Working with CKAN in Development" href="working_ckan.html" />
    <link rel="prev" title="Setup with VMWare Image" href="ubuntu_vm.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="working_ckan.html" title="Working with CKAN in Development"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ubuntu_vm.html" title="Setup with VMWare Image"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Tethys Platform 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../dev_environment.html" accesskey="U">Setup Development Environment</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="docker-development-environment">
<h1>Docker Development Environment<a class="headerlink" href="#docker-development-environment" title="Permalink to this headline">¶</a></h1>
<p><strong>Last Updated:</strong> May 30, 2014</p>
<p>This method make use of the <a class="reference external" href="https://www.docker.io/">Docker virtualization container</a> system. A pair of Docker container images have been prepared with a full installation of the Tethys Apps development environment. At this time, an Ubuntu installation is still required to use this method. Follow the <a class="reference internal" href="manual_install.html#install-ubuntu"><em>Install Ubuntu</em></a> instructions to setup Ubuntu. Then follow the instructions below to install Docker and the Tethys development environment containers. After Ubuntu is installed, plan on about 10-15 minutes to get the development environment setup. This method is the next fastest way to get setup if you do not have VMWare.</p>
<p>There are two Docker containers that are needed to deploy the Tethys development environment: <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> and <tt class="docutils literal"><span class="pre">tethys_dev_data</span></tt>. The <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> container is comprised of CKAN with all the plugins for Tethys Apps installed to provide a development environment for Tethys app development. The <tt class="docutils literal"><span class="pre">tethys_dev_data</span></tt> container houses all of the data dependencies for the Tethys Apps development environment (postgresql, filestore, datastore, solr, and tethys apps databases). This allows user data, app data, and datasets to be persisted when the <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> container is updated.</p>
<div class="section" id="install-docker">
<h2>Install Docker<a class="headerlink" href="#install-docker" title="Permalink to this headline">¶</a></h2>
<p>Start up your Ubuntu computer and follow the instructions on for <a class="reference external" href="http://docs.docker.io/installation/ubuntulinux/">Installing Docker on Ubuntu</a> to install Docker. Be sure to follow the instructions for the version of Ubuntu that you are using.</p>
</div>
<div class="section" id="pull-docker-images">
<h2>Pull Docker Images<a class="headerlink" href="#pull-docker-images" title="Permalink to this headline">¶</a></h2>
<p>Pull the <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> and <tt class="docutils literal"><span class="pre">tethys_dev_data</span></tt> images from the Docker Public Repository. In a terminal:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker pull ciwater/tethys_dev
$ sudo docker pull ciwater/tethys_dev_data
</pre></div>
</div>
<p>Confirm that this worked by executing the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker images
</pre></div>
</div>
<p>You should see the <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> and <tt class="docutils literal"><span class="pre">tethys_dev_data</span></tt> images listed in the print out.</p>
</div>
<div class="section" id="create-containers">
<span id="create-docker-containers"></span><h2>Create Containers<a class="headerlink" href="#create-containers" title="Permalink to this headline">¶</a></h2>
<p>After you have pulled the Docker images, you will need to use the Docker <strong class="command">run</strong> command to create the containers:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker run -d -p 5555:5432 -p 8080:8080 --name tethys_dev_data ciwater/tethys_dev_data
$ sudo docker run -i -t -p 5000:5000 --link tethys_dev_data:data --volumes-from tethys_dev_data -v &lt;apps_working_directory&gt;:/usr/lib/ckan/apps_projects:rw --name tethys_dev ciwater/tethys_dev
</pre></div>
</div>
<p>Replace <strong>&lt;apps_working_directory&gt;</strong> with the directory where you will create your app projects. The <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> Docker will automatically install and load any app in this directory.</p>
<p>The Docker container instances are assigned names that match their image names to make them more covenient to work with (&#8220;tethys_dev_data&#8221; for the <tt class="docutils literal"><span class="pre">tethys_data_dev</span></tt> container and &#8220;tethys_dev&#8221; for the <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> container). When you run the <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> container, it will print status output from the server that is running CKAN to the terminal.</p>
<p>After you have created the containers, stop them. Stop the <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> container by using the key combination <tt class="kbd docutils literal"><span class="pre">ctrl-C</span></tt> in the terminal where it is running. The <tt class="docutils literal"><span class="pre">tethys_dev_data</span></tt> container can be stopped using the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker stop tethys_dev_data
</pre></div>
</div>
<p>Check to make sure both containers were created correctly with the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker ps -a
</pre></div>
</div>
<p>This will list all of the Docker containers that are available for running. You should see two Docker containers with the names &#8220;tethys_dev&#8221; and &#8220;tethys_dev_data&#8221;. Notice that the &#8220;tethys_dev_data&#8221; container has a second name: &#8220;tethys_dev/data&#8221; This is because these containers are linked. Remember that &#8220;tethys_dev_data&#8221; must be started before &#8220;tethys_dev&#8221;, because they are linked.</p>
</div>
<div class="section" id="start-and-stop-containers">
<h2>Start and Stop Containers<a class="headerlink" href="#start-and-stop-containers" title="Permalink to this headline">¶</a></h2>
<p>After the containers have been created the first time, they can be started everytime after that using the following commands:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker start tethys_dev_data
$ sudo docker start -a -i tethys_dev
</pre></div>
</div>
<p>NOTE: The containers must be started in this order. The <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> container depends on the <tt class="docutils literal"><span class="pre">tethys_dev_data</span></tt> container running.</p>
<p>The &#8220;a&#8221; and &#8220;i&#8221; options allow you to see the output from the server that is running CKAN and Tethys apps. This is useful for debugging. To stop the <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> container, use the key combination <tt class="kbd docutils literal"><span class="pre">ctrl-C</span></tt> as before. Both containers can be stopped in another terminal using:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker stop tethys_dev_data
$ sudo docker stop tethys_dev
</pre></div>
</div>
</div>
<div class="section" id="create-new-app-projects">
<h2>Create New App Projects<a class="headerlink" href="#create-new-app-projects" title="Permalink to this headline">¶</a></h2>
<p>New app projects can be created using the Tethys app scaffold by issuing the following command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker run --rm -i -t -v &lt;apps_working_directory&gt;:/usr/lib/ckan/apps_projects:rw ciwater/tethys_dev ./createapp &lt;app_name&gt;
</pre></div>
</div>
<p>Replace <strong>&lt;apps_working_directory&gt;</strong> with the path to the directory where you will work on your apps projects (same as in the <a class="reference internal" href="#create-docker-containers"><em>Create Containers</em></a> section). Also, replace <strong>&lt;app_name&gt;</strong> with the name of the app that you would like to create. The app name must have &#8220;ckanapp-&#8221; as a prefix. The new app project will be created in the <strong>&lt;apps_working_directory&gt;</strong>.</p>
</div>
<div class="section" id="data-inspection">
<h2>Data Inspection<a class="headerlink" href="#data-inspection" title="Permalink to this headline">¶</a></h2>
<p>You can inspect the CKAN and TETHYS database using a PostgreSQL client such as <a class="reference external" href="http://askubuntu.com/questions/220123/how-do-i-install-pgadmin-iii-for-postgresql-9-2">PGAdminIII</a>. To do so, start the <tt class="docutils literal"><span class="pre">tethys_dev_data</span></tt> container and use the following credentials to connect:</p>
<div class="highlight-python"><div class="highlight"><pre>Host: localhost
Port: 5555
Username: tethys
Password: pass
Database: tethys
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <em>tethys</em> user is a superuser for the database.</p>
</div>
<p>The various data directories and log directories can be inspected by creating a new docker container that binds to the volumes of <tt class="docutils literal"><span class="pre">tethys_dev_data</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo docker run --rm -i -t --volumes-from tethys_dev_data ubuntu bash
</pre></div>
</div>
<p>Useful directories include:</p>
<div class="highlight-python"><div class="highlight"><pre>/var/lib/ckan/default    (FileStore data directory)
/etc/solr/conf           (Solr configuration)
/var/log/supervisor      (Solr/Jetty and PostgreSQL logs)
</pre></div>
</div>
</div>
<div class="section" id="tethys-development-client">
<h2>Tethys Development Client<a class="headerlink" href="#tethys-development-client" title="Permalink to this headline">¶</a></h2>
<p>There is a command line client available for working with the Tethys development environment. To install the client execute the following in a terminal:</p>
<div class="highlight-python"><div class="highlight"><pre>$ cd /tmp
$ wget &quot;https://bitbucket.org/swainn/tethys_docker/raw/83598c78c41d9fdad06b16f8793bed3ea361fe58/development/tethys_dev_client/tethysdc&quot;
$ chmod +x tethysdc
$ sudo mv tethysdc /usr/local/bin
</pre></div>
</div>
<p>There are three commands that you can use with the Tethys development client: <strong class="command">start</strong>, <strong class="command">stop</strong>, and <strong class="command">create</strong>. Use the <strong class="command">start</strong> to start the Tethys development Docker containers:</p>
<div class="highlight-python"><div class="highlight"><pre>$ tethysdc start db
$ tethysdc start tethys
</pre></div>
</div>
<p>Use the client to stop your Tethys development containers:</p>
<div class="highlight-python"><div class="highlight"><pre>$ tethysdc stop
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To stop the <tt class="docutils literal"><span class="pre">tethys_dev</span></tt> while output is printing to the terminal, press <tt class="kbd docutils literal"><span class="pre">ctrl-C</span></tt> as before.</p>
</div>
<p>Use the client to create new apps using the <strong class="command">create</strong> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ tethysdc create &lt;apps_working_directory&gt; &lt;app_name&gt;
</pre></div>
</div>
<p>Replace <strong>&lt;apps_working_directory&gt;</strong> with the path to the directory with your Tethys app projects and replace <strong>&lt;app_name&gt;</strong> with the name of the app to be created. Follow the interactive prompts to set metadata about your app. The <strong>&lt;app_name&gt;</strong> must start with the &#8220;ckanapp-&#8221; prefix (e.g.: ckanapp-my_first_app). The new app project will be created in the <strong>&lt;apps_working_directory&gt;</strong>.</p>
</div>
<div class="section" id="build-docker-images-from-source">
<h2>Build Docker Images from Source<a class="headerlink" href="#build-docker-images-from-source" title="Permalink to this headline">¶</a></h2>
<p>You may want to build from source if you want the very latest version of the Tethys Apps plugin or if you are aiding in the development of the Tethys Apps Dockers.</p>
<ol class="arabic simple">
<li>Create working directory:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ mkdir ~/tethysdev
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This directory can be located wherever you would like, but be sure to use your path in the following steps if you don&#8217;t use the suggested directory.</p>
</div>
<ol class="arabic simple" start="2">
<li>Retrive the tethys_docker source repository:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ cd ~/tethysdev
$ git clone https://swainn@bitbucket.org/swainn/tethys_docker.git
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Build container images from docker files:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre>$ cd ~/tethysdev/tethys_docker/development/tethys_dev_data
$ sudo docker build -t ciwater/tethys_dev_data .
$ cd ~/tethysdev/tethys_docker/development/tethys_dev
$ sudo docker build -t ciwater/tethys_dev .
</pre></div>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Often the build will fail due connection problems during apt-get update. It may be necessary to run the Docker <strong class="command">build</strong> command <strong>MANY</strong> times before it finally succeeds.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Docker Development Environment</a><ul>
<li><a class="reference internal" href="#install-docker">Install Docker</a></li>
<li><a class="reference internal" href="#pull-docker-images">Pull Docker Images</a></li>
<li><a class="reference internal" href="#create-containers">Create Containers</a></li>
<li><a class="reference internal" href="#start-and-stop-containers">Start and Stop Containers</a></li>
<li><a class="reference internal" href="#create-new-app-projects">Create New App Projects</a></li>
<li><a class="reference internal" href="#data-inspection">Data Inspection</a></li>
<li><a class="reference internal" href="#tethys-development-client">Tethys Development Client</a></li>
<li><a class="reference internal" href="#build-docker-images-from-source">Build Docker Images from Source</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="ubuntu_vm.html"
                        title="previous chapter">Setup with VMWare Image</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="working_ckan.html"
                        title="next chapter">Working with CKAN in Development</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/development/docker_env.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="working_ckan.html" title="Working with CKAN in Development"
             >next</a> |</li>
        <li class="right" >
          <a href="ubuntu_vm.html" title="Setup with VMWare Image"
             >previous</a> |</li>
        <li><a href="../index.html">Tethys Platform 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../dev_environment.html" >Setup Development Environment</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Nathan Swain.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>