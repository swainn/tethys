<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Distributing Apps &mdash; Tethys Platform 0.1.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Tethys Platform 0.1.0 documentation" href="../index.html" />
    <link rel="up" title="Getting Started" href="../getting_started.html" />
    <link rel="next" title="Deploy Apps in Production" href="../production_deployment.html" />
    <link rel="prev" title="Configuring Apps" href="configuration.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../production_deployment.html" title="Deploy Apps in Production"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuring Apps"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Tethys Platform 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../getting_started.html" accesskey="U">Getting Started</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="distributing-apps">
<h1>Distributing Apps<a class="headerlink" href="#distributing-apps" title="Permalink to this headline">¶</a></h1>
<p><strong>Last Updated:</strong> June 4, 2014</p>
<p>Once your app is complete, you will likely want to distribute it for others to use or at the very least install it in a production Tethys Apps environment. When you share your app with others, give them the entire :term:` release package` The <a class="reference internal" href="../glossary.html#term-release-package"><em class="xref std std-term">release package</em></a> directory is also a great place to include a README with any instructions specific installing your app. If there are no special instructions, you can refer them to the installation instructions for apps found in the <a class="reference internal" href="../working_with_apps.html"><em>Working with Apps</em></a> section. It is also a good idea to include a copy of the license you are releasing the app under in the <a class="reference internal" href="../glossary.html#term-release-package"><em class="xref std std-term">release package</em></a> directory.  Be sure to use the <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> to make installation of your app and all the dependencies as easy as possible. An explanation of the <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> is provided in the next section of this article.</p>
<div class="section" id="setup-script">
<h2>Setup Script<a class="headerlink" href="#setup-script" title="Permalink to this headline">¶</a></h2>
<p>When you generate your app using the scaffold, it will automatically come with a <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> (<tt class="file docutils literal"><span class="pre">setup.py</span></tt>), located in the top level directory of the <a class="reference internal" href="../glossary.html#term-release-package"><em class="xref std std-term">release package</em></a>. The <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> is used to store metadata about your app, install your app into Python, and install any dependencies it may have. We have added some additinal functionality specific to Tethys Apps to make the app installation process streamlined and easy. Open the setup script for your app (<tt class="file docutils literal"><span class="pre">~/tethysdev/ckanapp-my_first_app/setup.py</span></tt>).</p>
<div class="section" id="variables-section">
<h3>Variables Section<a class="headerlink" href="#variables-section" title="Permalink to this headline">¶</a></h3>
<p>The setup script is divided into several parts. The top of the script includes Python module imports followed by several variables similar to this example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">subprocess</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>
<span class="kn">from</span> <span class="nn">setuptools.command.develop</span> <span class="kn">import</span> <span class="n">develop</span>
<span class="kn">from</span> <span class="nn">setuptools.command.install</span> <span class="kn">import</span> <span class="n">install</span>

<span class="kn">from</span> <span class="nn">ckanext.tethys_apps.lib.persistent_store</span> <span class="kn">import</span> <span class="n">provision_persistent_stores</span>
<span class="kn">from</span> <span class="nn">ckanext.tethys_apps.lib</span> <span class="kn">import</span> <span class="n">get_ckanapp_directory</span>

<span class="c">### App Packages ###</span>
<span class="c"># Don&#39;t change these</span>
<span class="n">app_package</span> <span class="o">=</span> <span class="s">&#39;my_frist_app&#39;</span>
<span class="n">release_package</span> <span class="o">=</span> <span class="s">&#39;ckanapp-&#39;</span> <span class="o">+</span> <span class="n">app_package</span>
<span class="n">app_class</span> <span class="o">=</span> <span class="s">&#39;my_frist_app.app:MyFirstAppApp&#39;</span>

<span class="c">### App Metadata ###</span>
<span class="c"># Change whatever you&#39;d like here</span>
<span class="n">version</span> <span class="o">=</span> <span class="s">&#39;1.0&#39;</span>
<span class="n">author</span> <span class="o">=</span> <span class="s">&#39;Tethys User&#39;</span>
<span class="n">author_email</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">short_description</span> <span class="o">=</span> <span class="s">&#39;This is my very first app.&#39;</span>
<span class="n">long_description</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">license</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="n">keywords</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="c">### Python Dependencies ###</span>
<span class="c"># List external Python dependencies here by name</span>
<span class="n">dependencies</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c"># -*- Add names of external Python dependencies here -*-</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The variables section is where you will make most, if any, changes to the setup script. The variables under &#8220;App Packages&#8221; heading store information about the packages in your app including the <a class="reference internal" href="../glossary.html#term-app-package"><em class="xref std std-term">app package</em></a> name, <a class="reference internal" href="../glossary.html#term-release-package"><em class="xref std std-term">release package</em></a> name, and the path to the <a class="reference internal" href="../glossary.html#term-app-class"><em class="xref std std-term">app class</em></a>. These variables should generally not be changed. The &#8220;App Metadata&#8221; section contains variables that store metadata about your app such as the version, author, and license of your app. Feel free to modify the variables in this section to meet your needs. The final variable section, &#8220;Python Dependencies&#8221; contains one variable: <tt class="docutils literal"><span class="pre">dependencies</span></tt>. This variable is a list of Python package names that your app is dependent on. When they <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> is run, it will also install any dependencies listed in this variable.</p>
</div>
<div class="section" id="custom-installation-classes-section">
<h3>Custom Installation Classes Section<a class="headerlink" href="#custom-installation-classes-section" title="Permalink to this headline">¶</a></h3>
<p>The next section of the <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> includes two class definitions: <cite>CustomInstallCommand</cite> and <cite>CustomDevelopCommand</cite>. These classes are used by the <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> to perform additional steps during installation that are required to fully install an app. Typically, this portion of the <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> should not need to be modified. An example of what this section of the <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> looks like is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CustomInstallCommand</span><span class="p">(</span><span class="n">install</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When install command is used on setup.py, will copy app package to ckanapp directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get paths</span>
        <span class="n">ckanapp_dir</span> <span class="o">=</span> <span class="n">get_ckanapp_directory</span><span class="p">()</span>
        <span class="n">app_package_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">&#39;ckanapp&#39;</span><span class="p">,</span> <span class="n">app_package</span><span class="p">)</span>
        <span class="n">destination_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ckanapp_dir</span><span class="p">,</span> <span class="n">app_package</span><span class="p">)</span>

        <span class="c"># Notify user</span>
        <span class="k">print</span> <span class="s">&#39;Copying App Package: {0} to {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_package_dir</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>

        <span class="c"># Copy files</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">app_package_dir</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>

            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">app_package_dir</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>

        <span class="c"># Install dependencies</span>
        <span class="k">for</span> <span class="n">dependency</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&#39;pip&#39;</span><span class="p">,</span> <span class="s">&#39;install&#39;</span><span class="p">,</span> <span class="n">dependency</span><span class="p">])</span>

        <span class="c"># Run the original install command</span>
        <span class="n">install</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CustomDevelopCommand</span><span class="p">(</span><span class="n">develop</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    When develop command is used on setup.py, will create symbolic link from app package to ckanapp directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get paths</span>
        <span class="n">ckanapp_dir</span> <span class="o">=</span> <span class="n">get_ckanapp_directory</span><span class="p">()</span>
        <span class="n">app_package_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)),</span> <span class="s">&#39;ckanapp&#39;</span><span class="p">,</span> <span class="n">app_package</span><span class="p">)</span>
        <span class="n">destination_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ckanapp_dir</span><span class="p">,</span> <span class="n">app_package</span><span class="p">)</span>

        <span class="c"># Notify user</span>
        <span class="k">print</span> <span class="s">&#39;Creating Symbolic Link to App Package: {0} to {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">app_package_dir</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>

        <span class="c"># Create symbolic link</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">app_package_dir</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>

            <span class="n">os</span><span class="o">.</span><span class="n">symlink</span><span class="p">(</span><span class="n">app_package_dir</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>

        <span class="c"># Install dependencies</span>
        <span class="k">for</span> <span class="n">dependency</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s">&#39;pip&#39;</span><span class="p">,</span> <span class="s">&#39;install&#39;</span><span class="p">,</span> <span class="n">dependency</span><span class="p">])</span>

        <span class="c"># Run the original develop command</span>
        <span class="n">develop</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-function-section">
<h3>Setup Function Section<a class="headerlink" href="#setup-function-section" title="Permalink to this headline">¶</a></h3>
<p>The next section of the setup script contains the actual call to the <tt class="docutils literal"><span class="pre">setup()</span></tt> function. This function takes all the variables from the section above as arguments with a few others that won&#8217;t be discussed in detail here. It is this function that actually runs the installation of your app. There are many other options that can be specified in the <tt class="docutils literal"><span class="pre">setup()</span></tt> function. Review the <a class="reference external" href="https://pythonhosted.org/setuptools/setuptools.html#installing-setuptools">setuptools</a> documentation for more information if you wish to take advatage of these options.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">setup</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="n">release_package</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="n">version</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="n">short_description</span><span class="p">,</span>
    <span class="n">long_description</span><span class="o">=</span><span class="n">long_description</span><span class="p">,</span>
    <span class="n">classifiers</span><span class="o">=</span><span class="p">[],</span> <span class="c"># Get strings from http://pypi.python.org/pypi?%3Aaction=list_classifiers</span>
    <span class="n">keywords</span><span class="o">=</span><span class="n">keywords</span><span class="p">,</span>
    <span class="n">author</span><span class="o">=</span><span class="n">author</span><span class="p">,</span>
    <span class="n">author_email</span><span class="o">=</span><span class="n">author_email</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
    <span class="n">license</span><span class="o">=</span><span class="n">license</span><span class="p">,</span>
    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ez_setup&#39;</span><span class="p">,</span> <span class="s">&#39;examples&#39;</span><span class="p">,</span> <span class="s">&#39;tests&#39;</span><span class="p">]),</span>
    <span class="n">namespace_packages</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;ckanapp&#39;</span><span class="p">,</span> <span class="s">&#39;ckanapp.&#39;</span> <span class="o">+</span> <span class="n">app_package</span><span class="p">],</span>
    <span class="n">include_package_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">zip_safe</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">install_requires</span><span class="o">=</span><span class="n">dependencies</span><span class="p">,</span>
    <span class="n">entry_points</span><span class="o">=</span>\
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">cmdclass</span><span class="o">=</span><span class="p">{</span>
        <span class="s">&#39;install&#39;</span><span class="p">:</span> <span class="n">CustomInstallCommand</span><span class="p">,</span>
        <span class="s">&#39;develop&#39;</span><span class="p">:</span> <span class="n">CustomDevelopCommand</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="database-provisioning-function-section">
<h3>Database Provisioning Function Section<a class="headerlink" href="#database-provisioning-function-section" title="Permalink to this headline">¶</a></h3>
<p>The final section of the <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a> is a call to the <tt class="docutils literal"><span class="pre">provision_persisnent_stores()</span></tt> function. This function automatically creates any databases that you have requeseted in the <a class="reference internal" href="../glossary.html#term-app-configuration-file"><em class="xref std std-term">app configuration file</em></a> (<tt class="file docutils literal"><span class="pre">app.py</span></tt>) using the <tt class="docutils literal"><span class="pre">registerPersistentStores()</span></tt> method. There should be no need to modify this section of the <a class="reference internal" href="../glossary.html#term-setup-script"><em class="xref std std-term">setup script</em></a>, but it could be helpful to know that this exists. For more information on automatic database provisioning, see <a class="reference internal" href="persistent_stores.html"><em>The Model and Persistent Stores</em></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Provision tethys databases for app</span>
<span class="n">provision_persistent_stores</span><span class="p">(</span><span class="n">app_class</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="production-installation">
<h2>Production Installation<a class="headerlink" href="#production-installation" title="Permalink to this headline">¶</a></h2>
<p>Follow the instructions found in the <a class="reference internal" href="../working_with_apps.html"><em>Working with Apps</em></a> section to install apps in production.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Distributing Apps</a><ul>
<li><a class="reference internal" href="#setup-script">Setup Script</a><ul>
<li><a class="reference internal" href="#variables-section">Variables Section</a></li>
<li><a class="reference internal" href="#custom-installation-classes-section">Custom Installation Classes Section</a></li>
<li><a class="reference internal" href="#setup-function-section">Setup Function Section</a></li>
<li><a class="reference internal" href="#database-provisioning-function-section">Database Provisioning Function Section</a></li>
</ul>
</li>
<li><a class="reference internal" href="#production-installation">Production Installation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="previous chapter">Configuring Apps</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../production_deployment.html"
                        title="next chapter">Deploy Apps in Production</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/getting_started/distribution.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../production_deployment.html" title="Deploy Apps in Production"
             >next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuring Apps"
             >previous</a> |</li>
        <li><a href="../index.html">Tethys Platform 0.1.0 documentation</a> &raquo;</li>
          <li><a href="../getting_started.html" >Getting Started</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Nathan Swain.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>